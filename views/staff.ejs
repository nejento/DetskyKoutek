<%- include ("templates/header") %>

<main role="main">
    <div class="jumbotron small-jumbotron">
        <div class="container">
            <h1 class="display-4 pb-4">Přehled asistentů</h1>
            <!--<p><%= title %></p>-->
            <div class="row">
                <div class="container">
                    <h2 class="pb-3 border-bottom">Vaše nejbližší rezervace</h2>

                    <%
                    if (typeof todayReservations != 'undefined' && todayReservations.length > 0) {
                        %>
                        <div class="container">
                            <div class="row row-cols-1 row-cols-md-3">
                            <%
                                for (let i = 0; i < todayReservations.length; i++) {
                                    let rezervace = todayReservations[i],
                                        dateDifference = new Date(new Date() - rezervace.birthdate),
                                        diteVek = Math.abs(dateDifference.getUTCFullYear() - 1970),
                                        rezervaceStart = new Date(rezervace.time_from),
                                        rezervaceEnd = new Date(rezervace.time_to),
                                        options = { weekday: 'long', month: 'long', day: 'numeric' },
                                        rezervaceDate = rezervaceStart.toLocaleDateString('cs-CZ', options),
                                        rezervaceStartTime = rezervaceStart.getHours() + ":" + rezervaceStart.getMinutes() + (rezervaceStart.getMinutes() === 0 ? "0" : ""),
                                        rezervaceEndTime = rezervaceEnd.getHours() + ":" + rezervaceEnd.getMinutes() + (rezervaceEnd.getMinutes() === 0 ? "0" : "");
                                    %>
                                    <div class="card">
                                        <div class="card-header">
                                            <%= rezervace.name %> <%= rezervace.surname %> <span class="text-muted">(<%= diteVek %>)</span>
                                        </div>
                                        <div class="card-body">
                                            <h5 class="card-title"><%= rezervaceDate %>, <%= rezervaceStartTime %>&mdash;<%= rezervaceEndTime %></h5>
                                            <p class="card-text"><span class="text-muted">Rodič: </span><%= rezervace.parentName %> <%= rezervace.parentSurname %> &bullet; <span class="text-muted">Kontakt na rodiče: </span><%= rezervace.contact %></p>
                                            <%
                                            if (rezervace.parent_note != null && rezervace.parent_note !== "") {
                                                %>
                                                <p class="card-text"><span class="text-muted">Poznámka rodiče: </span><%= rezervace.parent_note %></p>
                                                <%
                                            }
                                            if (rezervace.staff_note != null && rezervaceEndTime.staff_note !== "") {
                                                %>
                                                <p class="card-text"><span class="text-muted">Poznámka pro asistenty: </span><%= rezervace.staff_note %></p>
                                                <%
                                            }
                                            %>
                                        </div>
                                    </div>
                                    <%
                                }
                            %>
                            </div>
                        </div>
                        <%
                    }

                    if (typeof otherReservations != 'undefined' && otherReservations.length > 0) {
                        %>
                        <h5 class="mt-2">Další rezervace</h5>
                        <div class="list-group">
                        <%

                        for (let i = 0; i < otherReservations.length; i++) {
                            let rezervace = otherReservations[i],
                                    dateDifference = new Date(new Date() - rezervace.birthdate),
                                    diteVek = Math.abs(dateDifference.getUTCFullYear() - 1970),
                                    rezervaceStart = new Date(rezervace.time_from),
                                    rezervaceEnd = new Date(rezervace.time_to),
                                    options = {weekday: 'long', month: 'long', day: 'numeric'},
                                    rezervaceDate = rezervaceStart.toLocaleDateString('cs-CZ', options),
                                    rezervaceStartTime = rezervaceStart.getHours() + ":" + rezervaceStart.getMinutes() + (rezervaceStart.getMinutes() === 0 ? "0" : ""),
                                    rezervaceEndTime = rezervaceEnd.getHours() + ":" + rezervaceEnd.getMinutes() + (rezervaceEnd.getMinutes() === 0 ? "0" : "");
                            %>
                            <div class="list-group-item list-group-item-action"><%= rezervace.name %> <%= rezervace.surname %> <span class="text-muted">(<%= diteVek %>)</span><span class="float-right"><%= rezervaceDate %>, <%= rezervaceStartTime %>—<%= rezervaceEndTime %></span></div>
                            <%
                        }
                        %>
                        </div>
                        <%

                    }

                    if ((typeof otherReservations == 'undefined' && typeof todayReservations == 'undefined') || (otherReservations.length === 0 && todayReservations.length === 0)) {
                        %>
                        <div class="alert alert-secondary" role="alert">
                            Nejsou přiděleny žádné děti na hlídání.
                        </div>
                        <%
                    }

                    %>

                </div>
            </div>
        </div>
    </div>

    <div class="row">
        <div class="container">
            <h3 class="pb-3 border-bottom">Váš rozvrh</h3>
            <div id='calendar'></div>
        </div>
    </div>

    <!-- Toasty -->
    <%- include ("templates/toasttemplate") %>

    <!-- Přidání a úprava času v kalendáři -->
    <div id="timeModal" class="modal fade bd-modal-xl" tabindex="-1" role="dialog" aria-labelledby="myExtraLargeModalLabel" aria-hidden="true">
        <div class="modal-dialog modal modal-dialog-centered" role="document">
            <div class="modal-content">
                <div class="modal-header bg-fptul">
                    <h5 id="modalHeader" class="modal-title text-white">Přidat čas</h5>
                    <button type="button" class="close text-white" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <form id="modal-form">
                    <div class="modal-body">
                        <div id="no-success" class="alert alert-danger" role="alert" style="display: none">
                            Nepovedlo se přidat čas do kalendáře. Zkuste to prosím znovu.
                        </div>
                        <div id="no-valid" class="alert alert-warning" role="alert" style="display: none">
                            Zadaná data nejsou platná. Zadejte data v požadovaných formátech a zkuste to znovu.
                        </div>
                        <div class="mb-3">
                            <label for="jmeno" class="col-form-label">Datum a čas dostupnosti v koutku</label>
                            <div class="input-group date mb-3">
                                <div class="input-group-prepend">
                                    <span class="input-group-text"><i class="far fa-calendar"></i></span>
                                </div>
                                <input type="text" id="date" class="form-control" aria-label="Datum volného času" placeholder="dd. mm. rrrr" pattern="(\d{1,2})[.\s]*(\d{1,2})[.\s]*(\d{4})" title="Datum musí být uvedeno ve formátu dd. mm. rrrr (např. 23. 5. 2021)" value="" required />
                                <div class="invalid-feedback">
                                    Datum je vyžadováno
                                </div>
                            </div>
                            <div class="input-group">
                                <div class="input-group-prepend">
                                    <span class="input-group-text">Od</span>
                                </div>
                                <input type="time" aria-label="Od" id="timeFrom" placeholder="7:00" class="form-control" pattern="([01]?[0-9]|2[0-3])[:.,]([0-5][0-9])" title="Čas začátku musí být ve formátu hh:mm (např. 8:00)" value="" required />
                                <div class="input-group-prepend">
                                    <span class="input-group-text">Do</span>
                                </div>
                                <input type="time" aria-label="Do" id="timeTo" placeholder="18:00" class="form-control" pattern="([01]?[0-9]|2[0-3])[:.,]([0-5][0-9])" title="Čas konce musí být ve formátu hh:mm (např. 15:00)" value="" required />
                            </div>
                        </div>

                        <div class="mb-3">
                            <div class="custom-control custom-checkbox">
                                <input type="checkbox" class="custom-control-input" id="isRepeating">
                                <label class="custom-control-label" for="isRepeating">Termín se opakuje pravidelně</label>
                            </div>
                            <div id="repeating" style="display: none">
                                <label for="repeatingStart" class="col-form-label">Termín se opakuje mezi těmito daty:</label>
                                <div class="input-group">
                                    <div class="input-daterange input-group" id="repeatingRange">
                                        <div class="input-group-prepend">
                                            <span class="input-group-text">Od</span>
                                        </div>
                                        <input type="text" aria-label="Od" id="repeatingFrom" class="form-control" placeholder="dd. mm. rrrr" value="" />
                                        <div class="input-group-prepend">
                                            <span class="input-group-text">Do</span>
                                        </div>
                                        <input type="text" aria-label="Do" id="repeatingTo" class="form-control" placeholder="dd. mm. rrrr" value="" />
                                    </div>
                                </div>
                                <div class="invalid-feedback">
                                    Pokud je opakování termínu zvoleno, je nutné nastavit data od kdy do kdy je opakování platné
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" id="modalRemove" class="btn btn-outline-danger mr-auto">Odstranit</button>
                        <button type="submit" id="modalSubmit" class="btn btn-primary">Přidat čas</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

</main>

<script src="/scripts/staff.js"></script>

<hr/>

<%- include ("templates/footer") %>